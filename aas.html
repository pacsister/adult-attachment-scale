<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Revised Adult Attachment Scale (Collins, 1996) — Bilingual (EN/繁)</title>
<style>
  :root {
    --bg: #0b1020;
    --card: rgba(255,255,255,0.06);
    --text: rgba(255,255,255,0.92);
    --muted: rgba(255,255,255,0.72);
    --muted2: rgba(255,255,255,0.55);
    --line: rgba(255,255,255,0.16);
    --focus: rgba(122, 162, 247, 0.85);
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    background: radial-gradient(1200px 700px at 20% 0%, rgba(122,162,247,0.20), transparent 60%),
                radial-gradient(1200px 700px at 100% 10%, rgba(236,72,153,0.12), transparent 55%),
                radial-gradient(1000px 700px at 50% 100%, rgba(52,211,153,0.10), transparent 55%),
                var(--bg);
    color: var(--text);
    line-height: 1.45;
  }
  .wrap { max-width: 1020px; margin: 0 auto; padding: 28px 18px 48px; }
  header { display: grid; gap: 10px; margin-bottom: 18px; }
  .title { font-size: 1.55rem; font-weight: 760; letter-spacing: 0.2px; }
  .subtitle { color: var(--muted); font-size: 0.98rem; max-width: 90ch; }
  .card { background: var(--card); border: 1px solid var(--line); border-radius: 16px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.22); }
  .card + .card { margin-top: 14px; }
  .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; justify-content: space-between; }
  .pill { display: inline-flex; gap: 8px; align-items: center; padding: 7px 10px; background: rgba(255,255,255,0.07); border: 1px solid var(--line); border-radius: 999px; color: var(--muted); font-size: 0.9rem; }
  .progress { height: 10px; background: rgba(255,255,255,0.10); border-radius: 999px; overflow: hidden; border: 1px solid var(--line); }
  .bar { height: 100%; width: 0%; background: linear-gradient(90deg, rgba(122,162,247,0.95), rgba(52,211,153,0.95)); border-radius: 999px; transition: width 180ms ease; }
  .note { color: var(--muted); font-size: 0.92rem; }
  .warnbox { border-left: 4px solid rgba(251,191,36,0.95); padding-left: 12px; }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

  .topControls { display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
  .langToggle { display:flex; gap:8px; align-items:center; }
  .seg { display:inline-flex; border:1px solid var(--line); border-radius: 999px; overflow:hidden; }
  .seg button {
    appearance:none; border:none; background: rgba(255,255,255,0.06);
    color: var(--muted); padding: 8px 12px; cursor:pointer; font-weight: 750;
  }
  .seg button.active { background: rgba(122,162,247,0.18); color: var(--text); }
  .seg button:focus-visible { outline: 3px solid rgba(122,162,247,0.55); outline-offset: 2px; }

  .items { display: grid; gap: 12px; margin-top: 12px; }
  .item { background: rgba(255,255,255,0.05); border: 1px solid var(--line); border-radius: 14px; padding: 12px; }
  .item:focus-within { outline: 2px solid rgba(122,162,247,0.7); outline-offset: 2px; }
  .qhead { display: grid; gap: 8px; margin-bottom: 8px; }
  .qnum { color: var(--muted2); font-size: 0.85rem; }
  .qtext { display:grid; gap:6px; }
  .en { font-size: 1.0rem; }
  .zh { font-size: 1.02rem; letter-spacing: 0.2px; }
  .mutedLine { color: var(--muted2); font-size: 0.88rem; }

  .likert { display: grid; grid-template-columns: repeat(5, minmax(44px, 1fr)); gap: 8px; }
  .opt { position: relative; }
  .opt input { position: absolute; inset: 0; opacity: 0; pointer-events: none; }
  .opt label { display: grid; place-items: center; height: 44px; border-radius: 12px; border: 1px solid var(--line); background: rgba(255,255,255,0.04); color: var(--muted); cursor: pointer; user-select: none; font-weight: 700; }
  .opt input:checked + label { background: rgba(122,162,247,0.18); border-color: rgba(122,162,247,0.55); color: var(--text); }
  .opt input:focus-visible + label { outline: 3px solid rgba(122,162,247,0.55); outline-offset: 2px; }

  .actions { display: flex; gap: 10px; flex-wrap: wrap; justify-content: flex-end; margin-top: 14px; }
  button.btn { appearance: none; border: 1px solid var(--line); background: rgba(255,255,255,0.06); color: var(--text); padding: 10px 12px; border-radius: 12px; cursor: pointer; font-weight: 720; }
  button.primary { background: rgba(52,211,153,0.14); border-color: rgba(52,211,153,0.55); }
  button.danger { background: rgba(248,113,113,0.12); border-color: rgba(248,113,113,0.55); }
  button.btn:hover { background: rgba(255,255,255,0.09); }
  button.primary:hover { background: rgba(52,211,153,0.18); }
  button.danger:hover { background: rgba(248,113,113,0.18); }

  .result { display:none; }
  .result.show { display:block; }
  table { width: 100%; border-collapse: collapse; overflow: hidden; border-radius: 14px; border: 1px solid var(--line); }
  th, td { padding: 10px 10px; border-bottom: 1px solid rgba(255,255,255,0.10); text-align: left; vertical-align: top; }
  th { font-size: 0.9rem; color: var(--muted); background: rgba(255,255,255,0.05); }
  td { font-size: 0.95rem; }
  .badge { display: inline-flex; align-items: center; gap: 8px; padding: 7px 10px; border-radius: 999px; border: 1px solid var(--line); background: rgba(255,255,255,0.06); font-weight: 760; }
  .badge.ok { border-color: rgba(52,211,153,0.7); background: rgba(52,211,153,0.14); }
  .badge.warn { border-color: rgba(251,191,36,0.7); background: rgba(251,191,36,0.12); }

  /* Language visibility */
  [data-lang="en"] .zhOnly { display:none !important; }
  [data-lang="zh"] .enOnly { display:none !important; }

  .printOnly { display:none; }
  @media print {
    body { background: white; color: black; }
    .card, table { box-shadow:none; }
    .actions, .progress, .pill, .topControls { display:none !important; }
    .printOnly { display:block; }
  }
</style>
</head>
<body>
<div class="wrap" id="app" data-lang="en">
  <header>
<nav class="shared-nav" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px;">
  <a href="index.html" style="text-decoration:none; color:#fff; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); padding:8px 10px; border-radius:999px; display:inline-flex; gap:8px; align-items:center;">
    <span style="font-weight:800;">Home</span><span style="opacity:.75;">主頁</span>
  </a>
  <a href="aas.html" style="text-decoration:none; color:#fff; border:1px solid rgba(255,255,255,.14); background:rgba(122,162,255,.12); padding:8px 10px; border-radius:999px; display:inline-flex; gap:8px; align-items:center;">
    <span style="font-weight:800;">AA Scale</span><span style="opacity:.75;">成人依附</span>
  </a>
  <a href="big5.html" style="text-decoration:none; color:#fff; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); padding:8px 10px; border-radius:999px; display:inline-flex; gap:8px; align-items:center;">
    <span style="font-weight:800;">Big Five</span><span style="opacity:.75;">五大人格</span>
  </a>
  <a href="holland.html" style="text-decoration:none; color:#fff; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); padding:8px 10px; border-radius:999px; display:inline-flex; gap:8px; align-items:center;">
    <span style="font-weight:800;">Holland</span><span style="opacity:.75;">職業興趣</span>
  </a>
</nav>

    <div class="title">
      <span class="enOnly">Revised Adult Attachment Scale (Collins, 1996) — Bilingual</span>
      <span class="zhOnly">成人依附量表（修訂版）（Collins, 1996）— 中英雙語</span>
    </div>
    <div class="subtitle">
      <span class="enOnly">Classroom self-scoring tool (no data is collected). Answer based on how you generally feel in important close relationships.</span>
      <span class="zhOnly">課堂自我計分工具（不會收集任何資料）。請按你在重要親密關係中的一般感受作答。</span>
    </div>
  </header>

  <div id="topNotice" class="card">
    <div class="topControls">
      <div class="langToggle">
        <span class="pill">
          <span class="enOnly">Language</span>
          <span class="zhOnly">語言</span>:
        </span>
        <div class="seg" role="tablist" aria-label="Language toggle">
          <button type="button" id="btnEN" class="active" aria-selected="true">English</button>
          <button type="button" id="btnZH" aria-selected="false">繁體中文</button>
        </div>
      </div>
      <div class="pill">
        <span class="enOnly">Items</span><span class="zhOnly">題目</span>:
        <span id="countDone" class="mono">0</span>/<span class="mono">18</span>
      </div>
    </div>

    <div style="margin-top:10px" class="progress" aria-label="Completion progress">
      <div id="bar" class="bar"></div>
    </div>

    <div class="note warnbox" style="margin-top:12px">
      <b><span class="enOnly">Privacy</span><span class="zhOnly">私隱</span>:</b>
      <span class="enOnly">Your answers are not sent anywhere and are not saved after you close this page. Use “Print / Save as PDF” on the Results screen if you need a record.</span>
      <span class="zhOnly">你的答案不會傳送至任何伺服器，關閉頁面後亦不會保存。如需保留紀錄，請在「結果」頁按「列印／另存為 PDF」。</span>
    </div>
  </div>

  <div class="card">
    <b>
      <span class="enOnly">Instructions</span>
      <span class="zhOnly">填寫指引</span>
    </b>
    <p class="note" style="margin-top:8px">
      <span class="enOnly">
        Think about your past and present relationships with people who have been especially important to you (family members, romantic partners, close friends).
        Respond to each statement in terms of how you generally feel in these relationships. Use the 1–5 scale below.
      </span>
      <span class="zhOnly">
        請回想你過去及現在與對你而言重要的人之關係（例如家庭成員、戀愛伴侶、親密朋友），並根據你在這些重要關係中的一般感受作答。請使用以下 1–5 分量表。
      </span>
    </p>

    <div class="row" style="margin-top:10px">
      <div class="pill">
        <span class="enOnly">Scale</span><span class="zhOnly">量表</span>:
        <span class="mono">1</span>
        <span class="enOnly">Not at all characteristic</span><span class="zhOnly">完全不符合</span>
        …
        <span class="mono">5</span>
        <span class="enOnly">Very characteristic</span><span class="zhOnly">非常符合</span>
      </div>
      <div class="pill">
        <span class="enOnly">Reverse-scored items are marked</span>
        <span class="zhOnly">需要反向計分的題目已標示</span>
        <span class="mono">*</span>
      </div>
    </div>

    <div class="note" style="margin-top:10px">
      <span class="enOnly"><b>No right or wrong answers.</b> Choose the option that best reflects you.</span>
      <span class="zhOnly"><b>沒有對或錯。</b> 請按最符合你的選項作答。</span>
    </div>
  </div>

  <form id="aasForm" class="card" autocomplete="off">
    <b><span class="enOnly">Items</span><span class="zhOnly">題目</span></b>
    <div class="items" id="items"></div>

    <div class="actions">
      <button type="button" class="btn" id="btnUnanswered">
        <span class="enOnly">Review unanswered</span>
        <span class="zhOnly">查看未答題目</span>
      </button>
      <button type="button" class="btn danger" id="btnReset">
        <span class="enOnly">Reset</span>
        <span class="zhOnly">重設</span>
      </button>
      <button type="submit" class="btn primary" id="btnScore">
        <span class="enOnly">Score & interpret</span>
        <span class="zhOnly">計分並解讀</span>
      </button>
    </div>
  </form>

  <div id="result" class="card result" aria-live="polite">
    <div class="row">
      <div>
        <div class="printOnly"><h2>Revised Adult Attachment Scale — Results / 成人依附量表（修訂版）— 結果</h2></div>
        <b><span class="enOnly">Your results</span><span class="zhOnly">你的結果</span></b>
        <div class="note" style="margin-top:6px">
          <span class="enOnly">Scores shown are <b>means</b> (range 1–5) after applying reverse scoring where needed.</span>
          <span class="zhOnly">以下為分量表的<b>平均分</b>（範圍 1–5），已按需要完成反向計分。</span>
        </div>
      </div>
      <div class="actions" style="margin-top:0">
        <button type="button" class="btn" id="btnBack">
          <span class="enOnly">Back to items</span>
          <span class="zhOnly">返回題目</span>
        </button>
        <button type="button" class="btn primary" id="btnPrint">
          <span class="enOnly">Print / Save as PDF</span>
          <span class="zhOnly">列印／另存為 PDF</span>
        </button>
      </div>
    </div>

    <div style="margin-top:12px">
      <table>
        <thead>
          <tr>
            <th><span class="enOnly">Subscale</span><span class="zhOnly">分量表</span></th>
            <th><span class="enOnly">Your mean</span><span class="zhOnly">你的平均分</span></th>
            <th><span class="enOnly">What it reflects</span><span class="zhOnly">含義</span></th>
            <th><span class="enOnly">Reference mean</span><span class="zhOnly">參考平均</span></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><b><span class="enOnly">Close</span><span class="zhOnly">親密感</span></b></td>
            <td class="mono" id="outClose">—</td>
            <td>
              <span class="enOnly">Comfort with closeness & intimacy.</span>
              <span class="zhOnly">對親密與情感連結的舒適程度。</span>
            </td>
            <td class="mono">3.77</td>
          </tr>
          <tr>
            <td><b><span class="enOnly">Depend</span><span class="zhOnly">依賴感</span></b></td>
            <td class="mono" id="outDepend">—</td>
            <td>
              <span class="enOnly">Comfort depending on others; belief others will be available.</span>
              <span class="zhOnly">對依賴他人及相信他人會在需要時提供支持的程度。</span>
            </td>
            <td class="mono">3.44</td>
          </tr>
          <tr>
            <td><b><span class="enOnly">Anxiety</span><span class="zhOnly">焦慮感</span></b></td>
            <td class="mono" id="outAnxiety">—</td>
            <td>
              <span class="enOnly">Worry about being rejected or unloved.</span>
              <span class="zhOnly">對被拒絕、不被愛或被遺棄的擔憂程度。</span>
            </td>
            <td class="mono">2.23</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card" style="margin-top:12px; background: rgba(255,255,255,0.04);">
      <div class="row" style="align-items:flex-start">
        <div style="flex:1 1 420px">
          <b><span class="enOnly">Attachment style (heuristic classification)</span><span class="zhOnly">依附風格（課堂示意分類）</span></b>
          <p class="note" style="margin-top:8px">
            <span class="enOnly">
              This uses simple cutoffs to operationalize “high / moderate / low”:
              High ≥ 3.50; Low ≤ 2.50; Moderate in-between.
            </span>
            <span class="zhOnly">
              以下以簡單分界將「高／中／低」具體化：高 ≥ 3.50；低 ≤ 2.50；其餘為中等。
            </span>
          </p>
          <p class="note">
            <span class="enOnly">If your course uses different cutoffs/norms, edit <span class="mono">HIGH_CUTOFF</span> / <span class="mono">LOW_CUTOFF</span> in the file.</span>
            <span class="zhOnly">如課堂採用其他分界或常模，請在檔案中修改 <span class="mono">HIGH_CUTOFF</span> / <span class="mono">LOW_CUTOFF</span>。</span>
          </p>
        </div>
        <div style="flex:1 1 320px">
          <div id="styleBadge" class="badge">—</div>
          <div class="note" id="styleText" style="margin-top:10px">—</div>
        </div>
      </div>
    </div>

    <details style="margin-top:12px">
      <summary style="cursor:pointer; color: var(--muted)">
        <span class="enOnly">Show scoring details (items & reverse scoring)</span>
        <span class="zhOnly">顯示計分細節（題目及反向計分）</span>
      </summary>
      <div class="note" style="margin-top:10px">
        <b><span class="enOnly">Close</span><span class="zhOnly">親密感</span></b>: 1, 6, 8*, 12, 13*, 17*<br/>
        <b><span class="enOnly">Depend</span><span class="zhOnly">依賴感</span></b>: 2*, 5, 7*, 14, 16*, 18*<br/>
        <b><span class="enOnly">Anxiety</span><span class="zhOnly">焦慮感</span></b>: 3, 4, 9, 10, 11, 15<br/>
        <span class="enOnly">Reverse-scored (*) uses</span><span class="zhOnly">反向計分（*）方法為</span>
        <span class="mono">(6 − your score / 6 − 原分)</span>.
      </div>
    </details>

    <div class="note" style="margin-top:10px">
      <b><span class="enOnly">Reminder</span><span class="zhOnly">提醒</span>:</b>
      <span class="enOnly">This is a classroom learning exercise and not a clinical diagnosis.</span>
      <span class="zhOnly">本量表用於課堂學習與自我反思，並非臨床診斷。</span>
    </div>
  </div>

</div>

<script>
  const ITEMS_EN = [" I find it relatively easy to get close to people.", " I find it difficult to allow myself to depend on others.", " I often worry that other people don't really love me.", " I find that others are reluctant to get as close as I would like.", " I am comfortable depending on others.", " I don’t worry about people getting too close to me.", " I find that people are never there when you need them.", " I am somewhat uncomfortable being close to others.", " I often worry that other people won’t want to stay with me.", " When I show my feelings for others, I'm afraid they will not feel the same about me.", " I often wonder whether other people really care about me.", " I am comfortable developing close relationships with others.", " I am uncomfortable when anyone gets too emotionally close to me.", " I know that people will be there when I need them.", " I want to get close to people, but I worry about being hurt.", " I find it difficult to trust others completely.", " People often want me to be emotionally closer than I feel comfortable being.", " I am not sure that I can always depend on people to be there when I need them."];
  const ITEMS_ZH = ["我覺得與他人建立親密關係相對來說是容易的。", "我覺得讓自己依賴他人是困難的。", "我經常擔心別人其實並不真正愛我。", "我發現他人往往不太願意與我建立像我期望般親密的關係。", "我對依賴他人感到自在。", "我不會擔心他人與我過於親近。", "我覺得當你真正需要他人時，他們往往不在你身邊。", "與他人保持親密關係會令我感到有點不自在。", "我經常擔心別人不會想一直與我維持關係。", "當我向他人表達自己的感受時，我會害怕對方並沒有同樣的感覺。", "我經常懷疑他人是否真的關心我。", "我對與他人發展親密關係感到自在。", "當他人在情感上與我過於親近時，我會感到不舒服。", "我知道當我需要時，他人會在我身邊支持我。", "我渴望與他人親近，但同時又擔心自己會受到傷害。", "我覺得要完全信任他人是困難的。", "他人往往希望在情感上與我保持比我所感到舒適的距離更親密的關係。", "我不太確定在我需要時，是否總能依賴他人。"];
  const REVERSE = new Set([2, 7, 8, 13, 16, 17, 18]);
  const CLOSE = [1, 6, 8, 12, 13, 17];
  const DEPEND = [2, 5, 7, 14, 16, 18];
  const ANXIETY = [3, 4, 9, 10, 11, 15];

  const HIGH_CUTOFF = 3.50;
  const LOW_CUTOFF  = 2.50;

  const app = document.getElementById('app');
  const form = document.getElementById('aasForm');
  const itemsDiv = document.getElementById('items');
  const bar = document.getElementById('bar');
  const countDone = document.getElementById('countDone');
  const resultDiv = document.getElementById('result');

  function setLang(lang) {
    app.setAttribute('data-lang', lang);
    try { localStorage.setItem('aas_lang', lang); } catch (e) {}
    const btnEN = document.getElementById('btnEN');
    const btnZH = document.getElementById('btnZH');
    btnEN.classList.toggle('active', lang === 'en');
    btnZH.classList.toggle('active', lang === 'zh');
    btnEN.setAttribute('aria-selected', lang === 'en' ? 'true' : 'false');
    btnZH.setAttribute('aria-selected', lang === 'zh' ? 'true' : 'false');
  }

  function fmt(x) {
    if (x === null || Number.isNaN(x)) return '—';
    return (Math.round(x * 100) / 100).toFixed(2);
  }

  function level(mean) {
    if (mean >= HIGH_CUTOFF) return 'high';
    if (mean <= LOW_CUTOFF) return 'low';
    return 'moderate';
  }

  function classify(closeM, dependM, anxM, lang) {
    const c = level(closeM), d = level(dependM), a = level(anxM);

    if (c === 'high' && d === 'high' && a === 'low') {
      return lang === 'zh'
        ? { label: '安全型', tone: 'ok', text: '模式：親密感高＋依賴感高＋焦慮感低。對親密與依賴較自在，較少擔心被拒絕或被遺棄。' }
        : { label: 'Secure', tone: 'ok', text: 'Pattern: high Close + high Depend + low Anxiety. Comfortable with closeness and depending on others; less worry about rejection or abandonment.' };
    }
    if (a === 'high' && (c === 'moderate' || c === 'high') && (d === 'moderate' || d === 'high')) {
      return lang === 'zh'
        ? { label: '焦慮型（依戀型）', tone: 'warn', text: '模式：焦慮感高，親密感與依賴感中至高。渴望親近，但較擔心不被愛或被拒絕。' }
        : { label: 'Anxious (preoccupied)', tone: 'warn', text: 'Pattern: high Anxiety with moderate/high Close and Depend. Desire for closeness, paired with stronger worry about being rejected or unloved.' };
    }
    if (c === 'low' && d === 'low' && a === 'low') {
      return lang === 'zh'
        ? { label: '逃避型', tone: 'warn', text: '模式：親密感低＋依賴感低＋焦慮感低。較不習慣情感上的親近或依賴他人，亦較少表現出對被拒絕的擔憂。' }
        : { label: 'Avoidant', tone: 'warn', text: 'Pattern: low Close + low Depend + low Anxiety. Less comfort with emotional closeness and relying on others; generally less expressed worry about rejection.' };
    }
    return lang === 'zh'
      ? { label: '混合／不明顯', tone: 'warn', text: '你的分量表模式未能清楚符合簡單的高／中／低分類。建議以三個維度的特徵作反思，而非強行套用單一標籤。' }
      : { label: 'Mixed / Not clearly classifiable', tone: 'warn', text: 'Your pattern does not neatly match the simple high/moderate/low profiles. Discuss how each dimension might show up in relationships rather than forcing a single label.' };
  }

  function buildItems() {
    itemsDiv.innerHTML = '';
    for (let idx = 0; idx < ITEMS_EN.length; idx++) {
      const q = idx + 1;
      const isRev = REVERSE.has(q);
      const item = document.createElement('div');
      item.className = 'item';
      item.id = `q${q}`;
      item.innerHTML = `
        <div class="qhead">
          <div class="qnum">
            <span class="enOnly">Item</span><span class="zhOnly">第</span> ${q} <span class="zhOnly">題</span>
            ${isRev ? ' <span class="mono">*</span>' : ''}
          </div>
          <div class="qtext">
            <div class="en enOnly">${ITEMS_EN[idx]}</div>
            <div class="zh zhOnly">${ITEMS_ZH[idx]}</div>
            ${isRev ? `
              <div class="mutedLine enOnly">* Reverse-scored item</div>
              <div class="mutedLine zhOnly">* 反向計分題目</div>
            ` : ``}
          </div>
        </div>
        <div class="likert" role="radiogroup" aria-label="Item ${q}">
          ${[1,2,3,4,5].map(v => `
            <div class="opt">
              <input id="q${q}_${v}" name="q${q}" type="radio" value="${v}">
              <label for="q${q}_${v}">${v}</label>
            </div>
          `).join('')}
        </div>
      `;
      itemsDiv.appendChild(item);
    }
  }

  function getAnswers() {
    const ans = {};
    for (let q = 1; q <= ITEMS_EN.length; q++) {
      const el = form.querySelector(\`input[name="q\${q}"]:checked\`);
      ans[q] = el ? Number(el.value) : null;
    }
    return ans;
  }

  function updateProgress() {
    const ans = getAnswers();
    let done = 0;
    for (let q = 1; q <= ITEMS_EN.length; q++) if (ans[q] !== null) done++;
    countDone.textContent = String(done);
    bar.style.width = (done / ITEMS_EN.length * 100).toFixed(1) + '%';
  }

  function reverseScore(q, value) {
    if (value === null) return null;
    return REVERSE.has(q) ? (6 - value) : value;
  }

  function meanOf(items, ans) {
    const vals = [];
    for (const q of items) {
      const v = reverseScore(q, ans[q]);
      if (v === null) return null;
      vals.push(v);
    }
    const sum = vals.reduce((a,b) => a + b, 0);
    return sum / vals.length;
  }

  function scrollToFirstUnanswered() {
    const ans = getAnswers();
    for (let q = 1; q <= ITEMS_EN.length; q++) {
      if (ans[q] === null) {
        const el = document.getElementById(\`q\${q}\`);
        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
      }
    }
    alert(app.getAttribute('data-lang') === 'zh' ? '已完成所有題目。' : 'All items are answered.');
  }

  function showResults(closeM, dependM, anxM) {
    document.getElementById('outClose').textContent = fmt(closeM);
    document.getElementById('outDepend').textContent = fmt(dependM);
    document.getElementById('outAnxiety').textContent = fmt(anxM);

    const lang = app.getAttribute('data-lang');
    const cls = classify(closeM, dependM, anxM, lang);
    const badge = document.getElementById('styleBadge');
    badge.className = \`badge \${cls.tone}\`;
    badge.innerHTML = \`<span>\${cls.label}</span> <span class="mono">(\${level(closeM)}/\${level(dependM)}/\${level(anxM)})</span>\`;
    document.getElementById('styleText').textContent = cls.text;

    resultDiv.classList.add('show');
    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // Init
  buildItems();
  updateProgress();

  try {
    const savedLang = localStorage.getItem('aas_lang');
    if (savedLang === 'zh' || savedLang === 'en') setLang(savedLang);
  } catch (e) {}

  document.getElementById('btnEN').addEventListener('click', () => setLang('en'));
  document.getElementById('btnZH').addEventListener('click', () => setLang('zh'));

  form.addEventListener('change', updateProgress);

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const ans = getAnswers();

    const missing = [];
    for (let q = 1; q <= ITEMS_EN.length; q++) if (ans[q] === null) missing.push(q);

    if (missing.length) {
      const msg = app.getAttribute('data-lang') === 'zh'
        ? ('請先完成所有題目才可計分。未答題號：' + missing.join('、'))
        : ('Please answer all items before scoring. Missing: ' + missing.join(', '));
      alert(msg);
      scrollToFirstUnanswered();
      return;
    }

    const closeM = meanOf(CLOSE, ans);
    const dependM = meanOf(DEPEND, ans);
    const anxM = meanOf(ANXIETY, ans);

    showResults(closeM, dependM, anxM);
  });

  document.getElementById('btnUnanswered').addEventListener('click', scrollToFirstUnanswered);

  document.getElementById('btnReset').addEventListener('click', () => {
    const lang = app.getAttribute('data-lang');
    const ok = confirm(lang === 'zh' ? '確定要重設所有答案？' : 'Reset all answers?');
    if (!ok) return;
    form.reset();
    updateProgress();
    resultDiv.classList.remove('show');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  document.getElementById('btnBack').addEventListener('click', () => {
    resultDiv.classList.remove('show');
    document.getElementById('topNotice').scrollIntoView({ behavior: 'smooth', block: 'start' });
  });

  document.getElementById('btnPrint').addEventListener('click', () => window.print());
</script>
<footer class="site-footer" style="margin-top:18px; padding-top:14px; border-top:1px solid rgba(255,255,255,.14); color: rgba(255,255,255,.72); font-size:12px; line-height:1.6;">
  <div style="display:flex; gap:12px; flex-wrap:wrap; justify-content:space-between; align-items:flex-start;">
    <div>
      <div style="font-weight:800; color: rgba(255,255,255,.86);">May Poon 潘美</div>
      <div>Hong Kong Community College (CPCE, PolyU) 香港專上學院（理大 CPCE）</div>
      <div>Contact / 聯絡：<span style="opacity:.9;">[edit me]</span></div>
    </div>
    <div style="max-width:520px;">
      <div style="font-weight:800; color: rgba(255,255,255,.86);">Use & Privacy / 用途與私隱</div>
      <div>For classroom learning and reflection. This site does not collect answers. / 僅供課堂學習與反思，本網站不會收集作答內容。</div>
    </div>
  </div>
  <div style="margin-top:10px; opacity:.8;">© 2026 May Poon. Teaching use only. / 教學用途。</div>
</footer>
</body>
</html>
