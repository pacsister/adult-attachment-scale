<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Revised Adult Attachment Scale (Collins, 1996) — Bilingual EN/繁</title>
<style>
  :root {
    --bg: #0b1020;
    --card: rgba(255,255,255,0.06);
    --text: rgba(255,255,255,0.92);
    --muted: rgba(255,255,255,0.72);
    --muted2: rgba(255,255,255,0.55);
    --line: rgba(255,255,255,0.16);
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    background: radial-gradient(1200px 700px at 20% 0%, rgba(122,162,247,0.20), transparent 60%),
                radial-gradient(1200px 700px at 100% 10%, rgba(236,72,153,0.12), transparent 55%),
                radial-gradient(1000px 700px at 50% 100%, rgba(52,211,153,0.10), transparent 55%),
                var(--bg);
    color: var(--text);
    line-height: 1.45;
  }
  .wrap { max-width: 1020px; margin: 0 auto; padding: 28px 18px 48px; }
  header { display: grid; gap: 10px; margin-bottom: 18px; }
  .title { font-size: 1.6rem; font-weight: 760; letter-spacing: 0.2px; }
  .subtitle { color: var(--muted); font-size: 0.98rem; max-width: 92ch; }

  .card { background: var(--card); border: 1px solid var(--line); border-radius: 16px; padding: 16px;
          box-shadow: 0 10px 30px rgba(0,0,0,0.22); }
  .card + .card { margin-top: 14px; }

  .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; justify-content: space-between; }
  .pill { display: inline-flex; gap: 8px; align-items: center; padding: 7px 10px;
          background: rgba(255,255,255,0.07); border: 1px solid var(--line); border-radius: 999px;
          color: var(--muted); font-size: 0.9rem; }

  .progress { height: 10px; background: rgba(255,255,255,0.10); border-radius: 999px; overflow: hidden; border: 1px solid var(--line); }
  .bar { height: 100%; width: 0%; background: linear-gradient(90deg, rgba(122,162,247,0.95), rgba(52,211,153,0.95));
         border-radius: 999px; transition: width 180ms ease; }

  .note { color: var(--muted); font-size: 0.92rem; }
  .warnbox { border-left: 4px solid rgba(251,191,36,0.95); padding-left: 12px; }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

  .topControls { display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
  .seg { display:inline-flex; border:1px solid var(--line); border-radius: 999px; overflow:hidden; }
  .seg button { appearance:none; border:none; background: rgba(255,255,255,0.06); color: var(--muted);
                padding: 8px 12px; cursor:pointer; font-weight: 760; }
  .seg button.active { background: rgba(122,162,247,0.18); color: var(--text); }
  .seg button:focus-visible { outline: 3px solid rgba(122,162,247,0.55); outline-offset: 2px; }

  .grid2 { display: grid; grid-template-columns: 1fr; gap: 12px; }
  @media (min-width: 860px) { .grid2 { grid-template-columns: 1.1fr 0.9fr; } }

  .items { display: grid; gap: 12px; margin-top: 12px; }
  .item { background: rgba(255,255,255,0.05); border: 1px solid var(--line); border-radius: 14px; padding: 12px; }
  .item:focus-within { outline: 2px solid rgba(122,162,247,0.7); outline-offset: 2px; }
  .qhead { display: grid; gap: 8px; margin-bottom: 8px; }
  .qnum { color: var(--muted2); font-size: 0.85rem; }
  .qtext { display:grid; gap:6px; }
  .enLine { font-size: 1.0rem; }
  .zhLine { font-size: 1.02rem; letter-spacing: 0.2px; }
  .mutedLine { color: var(--muted2); font-size: 0.88rem; }

  .likert { display: grid; grid-template-columns: repeat(5, minmax(44px, 1fr)); gap: 8px; }
  .opt { position: relative; }
  .opt input { position: absolute; inset: 0; opacity: 0; pointer-events: none; }
  .opt label { display: grid; place-items: center; height: 44px; border-radius: 12px; border: 1px solid var(--line);
               background: rgba(255,255,255,0.04); color: var(--muted); cursor: pointer; user-select: none; font-weight: 700; }
  .opt input:checked + label { background: rgba(122,162,247,0.18); border-color: rgba(122,162,247,0.55); color: var(--text); }
  .opt input:focus-visible + label { outline: 3px solid rgba(122,162,247,0.55); outline-offset: 2px; }

  .actions { display: flex; gap: 10px; flex-wrap: wrap; justify-content: flex-end; margin-top: 14px; }
  button.btn { appearance: none; border: 1px solid var(--line); background: rgba(255,255,255,0.06); color: var(--text);
               padding: 10px 12px; border-radius: 12px; cursor: pointer; font-weight: 740; }
  button.primary { background: rgba(52,211,153,0.14); border-color: rgba(52,211,153,0.55); }
  button.danger { background: rgba(248,113,113,0.12); border-color: rgba(248,113,113,0.55); }
  button.btn:hover { background: rgba(255,255,255,0.09); }
  button.primary:hover { background: rgba(52,211,153,0.18); }
  button.danger:hover { background: rgba(248,113,113,0.18); }

  .result { display:none; }
  .result.show { display:block; }

  table { width: 100%; border-collapse: collapse; overflow: hidden; border-radius: 14px; border: 1px solid var(--line); }
  th, td { padding: 10px 10px; border-bottom: 1px solid rgba(255,255,255,0.10); text-align: left; vertical-align: top; }
  th { font-size: 0.9rem; color: var(--muted); background: rgba(255,255,255,0.05); }
  td { font-size: 0.95rem; }

  .badge { display: inline-flex; align-items: center; gap: 8px; padding: 7px 10px; border-radius: 999px;
           border: 1px solid var(--line); background: rgba(255,255,255,0.06); font-weight: 760; }
  .badge.ok { border-color: rgba(52,211,153,0.7); background: rgba(52,211,153,0.14); }
  .badge.warn { border-color: rgba(251,191,36,0.7); background: rgba(251,191,36,0.12); }

  [data-lang="en"] .zhOnly { display:none !important; }
  [data-lang="zh"] .enOnly { display:none !important; }

  .printOnly { display:none; }
  @media print {
    body { background: white; color: black; }
    .card, table { box-shadow:none; }
    #topNotice, .progress, .pill, .topControls, .actions { display:none !important; }
    .printOnly { display:block; }
  }
</style>
</head>
<body>
<div class="wrap" id="app" data-lang="en">
  <header>
    <div class="title">
      <span class="enOnly">Revised Adult Attachment Scale (Collins, 1996) — Close Relationships Version</span>
      <span class="zhOnly">成人依附量表（修訂版）（Collins, 1996）— 親密關係版本</span>
    </div>
    <div class="subtitle">
      <span class="enOnly">Educational self-scoring (no data is collected). Answer based on how you generally feel in important close relationships.</span>
      <span class="zhOnly">課堂自我計分（不會收集資料）。請按你在重要親密關係中的一般感受作答。</span>
    </div>
  </header>

  <div id="topNotice" class="card">
    <div class="topControls">
      <div class="row" style="justify-content:flex-start; gap:12px;">
        <span class="pill"><span class="enOnly">Language</span><span class="zhOnly">語言</span>:</span>
        <div class="seg" role="tablist" aria-label="Language toggle">
          <button type="button" id="btnEN" class="active" aria-selected="true">English</button>
          <button type="button" id="btnZH" aria-selected="false">繁體中文</button>
        </div>
      </div>
      <div class="pill">
        <span class="enOnly">Items answered</span><span class="zhOnly">已作答題目</span>:
        <span id="countDone" class="mono">0</span>/<span class="mono">18</span>
      </div>
    </div>

    <div style="margin-top:10px" class="progress" aria-label="Completion progress">
      <div id="bar" class="bar"></div>
    </div>

    <div class="note warnbox" style="margin-top:12px">
      <b><span class="enOnly">Privacy</span><span class="zhOnly">私隱</span>:</b>
      <span class="enOnly">Your answers are not sent anywhere and are not saved after you close this page. Use “Print / Save as PDF” on the Results screen if you need a record.</span>
      <span class="zhOnly">你的答案不會傳送至任何伺服器，關閉頁面後亦不會保存。如需保留紀錄，請在「結果」頁按「列印／另存為 PDF」。</span>
    </div>
  </div>

  <div class="card">
    <div class="grid2">
      <div>
        <b><span class="enOnly">Instructions</span><span class="zhOnly">填寫指引</span></b>
        <p class="note" style="margin-top:8px">
          <span class="enOnly">
            Think about your past and present relationships with people who have been especially important to you (family members, romantic partners, close friends).
            Respond to each statement in terms of how you generally feel in these relationships.
          </span>
          <span class="zhOnly">
            請回想你過去及現在與對你而言重要的人之關係（例如家庭成員、戀愛伴侶、親密朋友），並根據你在這些關係中的一般感受作答。
          </span>
        </p>
        <p class="note" style="margin-top:8px">
          <span class="enOnly">Select a number from <span class="mono">1</span> to <span class="mono">5</span> for each statement. There are no right or wrong answers.</span>
          <span class="zhOnly">每題請選擇 <span class="mono">1</span> 至 <span class="mono">5</span> 的分數。沒有對或錯，請按最符合你的選項作答。</span>
        </p>
        <div class="note" style="margin-top:10px">
          <span class="enOnly"><b>Scale anchors:</b> <span class="mono">1</span> Not at all characteristic of me … <span class="mono">5</span> Very characteristic of me</span>
          <span class="zhOnly"><b>量表說明：</b><span class="mono">1</span> 完全不符合我 … <span class="mono">5</span> 非常符合我</span>
        </div>
      </div>

      <div>
        <b><span class="enOnly">Scoring overview</span><span class="zhOnly">計分概覽</span></b>
        <p class="note" style="margin-top:8px">
          <span class="enOnly">
            Subscales are computed as the <b>mean of 6 items</b> each:
            <span class="mono">Close</span> (comfort with closeness),
            <span class="mono">Depend</span> (comfort depending on others),
            and <span class="mono">Anxiety</span> (worry about rejection/unlove).
          </span>
          <span class="zhOnly">
            每個分量表由 <b>6 題</b> 計算其<b>平均分</b>：
            <span class="mono">親密感（Close）</span>（對親密的舒適程度）、
            <span class="mono">依賴感（Depend）</span>（對依賴他人的舒適程度）、
            <span class="mono">焦慮感（Anxiety）</span>（對被拒絕／不被愛的擔憂）。
          </span>
        </p>
        <p class="note" style="margin-top:8px">
          <span class="enOnly">Reverse-scored items use <span class="mono">(6 − your score)</span>. They are marked with <span class="mono">*</span> on this page.</span>
          <span class="zhOnly">反向計分題目使用 <span class="mono">(6 − 原分)</span>，並以 <span class="mono">*</span> 標示。</span>
        </p>
      </div>
    </div>
  </div>

  <form id="aasForm" class="card" autocomplete="off">
    <b><span class="enOnly">Items</span><span class="zhOnly">題目</span></b>
    <div class="items" id="items"></div>

    <div class="actions">
      <button type="button" class="btn" id="btnUnanswered"><span class="enOnly">Review unanswered</span><span class="zhOnly">查看未答題目</span></button>
      <button type="button" class="btn danger" id="btnReset"><span class="enOnly">Reset</span><span class="zhOnly">重設</span></button>
      <button type="submit" class="btn primary" id="btnScore"><span class="enOnly">Score & interpret</span><span class="zhOnly">計分並解讀</span></button>
    </div>
  </form>

  <div id="result" class="card result" aria-live="polite">
    <div class="row">
      <div>
        <div class="printOnly"><h2>Revised Adult Attachment Scale — Results / 成人依附量表（修訂版）— 結果</h2></div>
        <b><span class="enOnly">Your results</span><span class="zhOnly">你的結果</span></b>
        <div class="note" style="margin-top:6px">
          <span class="enOnly">Scores shown are <b>means</b> (range 1–5) after applying reverse scoring where needed. Higher means indicate more of that dimension.</span>
          <span class="zhOnly">以下為分量表<b>平均分</b>（範圍 1–5），已按需要完成反向計分。平均分愈高表示該向度愈高。</span>
        </div>
      </div>
      <div class="actions" style="margin-top:0">
        <button type="button" class="btn" id="btnBack"><span class="enOnly">Back to items</span><span class="zhOnly">返回題目</span></button>
        <button type="button" class="btn primary" id="btnPrint"><span class="enOnly">Print / Save as PDF</span><span class="zhOnly">列印／另存為 PDF</span></button>
      </div>
    </div>

    <div style="margin-top:12px">
      <table>
        <thead>
          <tr>
            <th><span class="enOnly">Subscale</span><span class="zhOnly">分量表</span></th>
            <th><span class="enOnly">Your mean</span><span class="zhOnly">你的平均分</span></th>
            <th><span class="enOnly">Interpretation (dimension)</span><span class="zhOnly">解讀（向度）</span></th>
            <th><span class="enOnly">Reference mean (class handout)</span><span class="zhOnly">參考平均（課堂資料）</span></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><b><span class="enOnly">Close</span><span class="zhOnly">親密感</span></b></td>
            <td class="mono" id="outClose">—</td>
            <td id="txtClose">—</td>
            <td class="mono">3.77</td>
          </tr>
          <tr>
            <td><b><span class="enOnly">Depend</span><span class="zhOnly">依賴感</span></b></td>
            <td class="mono" id="outDepend">—</td>
            <td id="txtDepend">—</td>
            <td class="mono">3.44</td>
          </tr>
          <tr>
            <td><b><span class="enOnly">Anxiety</span><span class="zhOnly">焦慮感</span></b></td>
            <td class="mono" id="outAnxiety">—</td>
            <td id="txtAnxiety">—</td>
            <td class="mono">2.23</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card" style="margin-top:12px; background: rgba(255,255,255,0.04);">
      <div class="row" style="align-items:flex-start">
        <div style="flex:1 1 420px">
          <b><span class="enOnly">Attachment style (heuristic classification)</span><span class="zhOnly">依附風格（課堂示意分類）</span></b>
          <p class="note" style="margin-top:8px">
            <span class="enOnly">This page uses a simple cutoff to operationalize “high / moderate / low”:</span>
            <span class="zhOnly">本頁以簡單分界將「高／中／低」具體化：</span>
          </p>
          <ul class="note" style="margin-top:6px; margin-bottom:0">
            <li><b><span class="enOnly">High</span><span class="zhOnly">高</span></b>: <span class="mono">≥ 3.50</span></li>
            <li><b><span class="enOnly">Low</span><span class="zhOnly">低</span></b>: <span class="mono">≤ 2.50</span></li>
            <li><b><span class="enOnly">Moderate</span><span class="zhOnly">中</span></b>: <span class="mono">2.51–3.49</span></li>
          </ul>
          <p class="note" style="margin-top:8px">
            <span class="enOnly">If your course uses different cutoffs/norms, update <span class="mono">HIGH_CUTOFF</span>/<span class="mono">LOW_CUTOFF</span> in the code.</span>
            <span class="zhOnly">如課堂採用其他分界或常模，請在程式中修改 <span class="mono">HIGH_CUTOFF</span>/<span class="mono">LOW_CUTOFF</span>。</span>
          </p>
        </div>
        <div style="flex:1 1 320px">
          <div id="styleBadge" class="badge">—</div>
          <div class="note" id="styleText" style="margin-top:10px">—</div>
        </div>
      </div>
    </div>

    <div class="note" style="margin-top:10px">
      <b><span class="enOnly">Reminder</span><span class="zhOnly">提醒</span>:</b>
      <span class="enOnly">This is a classroom learning exercise and not a clinical diagnosis.</span>
      <span class="zhOnly">本量表用於課堂學習與自我反思，並非臨床診斷。</span>
    </div>

    <details style="margin-top:12px">
      <summary style="cursor:pointer; color: var(--muted)">
        <span class="enOnly">Show scoring details (items & reverse scoring)</span>
        <span class="zhOnly">顯示計分細節（題目及反向計分）</span>
      </summary>
      <div class="note" style="margin-top:10px">
        <b><span class="enOnly">Close</span><span class="zhOnly">親密感</span></b>: 1, 6, 8*, 12, 13*, 17*<br/>
        <b><span class="enOnly">Depend</span><span class="zhOnly">依賴感</span></b>: 2*, 5, 7*, 14, 16*, 18*<br/>
        <b><span class="enOnly">Anxiety</span><span class="zhOnly">焦慮感</span></b>: 3, 4, 9, 10, 11, 15<br/>
        <span class="enOnly">Reverse-scored items (*) use <span class="mono">(6 − your score)</span>.</span>
        <span class="zhOnly">反向計分題目（*）使用 <span class="mono">(6 − 原分)</span>。</span>
      </div>
    </details>
  </div>

  <div class="card" style="margin-top:14px">
    <b><span class="enOnly">Teacher notes (optional)</span><span class="zhOnly">教師備註（可選）</span></b>
    <p class="note" style="margin-top:8px">
      <span class="enOnly">You can host this as a single <span class="mono">index.html</span> file (e.g., GitHub Pages). No backend is required unless you want automatic submission/collection.</span>
      <span class="zhOnly">你可將此單一檔案 <span class="mono">index.html</span> 上載（例如 GitHub Pages）。如不需要自動收集答案，毋須後端伺服器。</span>
    </p>
  </div>
</div>

<script>
  const ITEMS_EN = [" I find it relatively easy to get close to people.", " I find it difficult to allow myself to depend on others.", " I often worry that other people don't really love me.", " I find that others are reluctant to get as close as I would like.", " I am comfortable depending on others.", " I don’t worry about people getting too close to me.", " I find that people are never there when you need them.", " I am somewhat uncomfortable being close to others.", " I often worry that other people won’t want to stay with me.", " When I show my feelings for others, I'm afraid they will not feel the same about me.", " I often wonder whether other people really care about me.", " I am comfortable developing close relationships with others.", " I am uncomfortable when anyone gets too emotionally close to me.", " I know that people will be there when I need them.", " I want to get close to people, but I worry about being hurt.", " I find it difficult to trust others completely.", " People often want me to be emotionally closer than I feel comfortable being.", " I am not sure that I can always depend on people to be there when I need them."];
  const ITEMS_ZH = ["我覺得與他人建立親密關係相對來說是容易的。", "我覺得讓自己依賴他人是困難的。", "我經常擔心別人其實並不真正愛我。", "我發現他人往往不太願意與我建立像我期望般親密的關係。", "我對依賴他人感到自在。", "我不會擔心他人與我過於親近。", "我覺得當你真正需要他人時，他們往往不在你身邊。", "與他人保持親密關係會令我感到有點不自在。", "我經常擔心別人不會想一直與我維持關係。", "當我向他人表達自己的感受時，我會害怕對方並沒有同樣的感覺。", "我經常懷疑他人是否真的關心我。", "我對與他人發展親密關係感到自在。", "當他人在情感上與我過於親近時，我會感到不舒服。", "我知道當我需要時，他人會在我身邊支持我。", "我渴望與他人親近，但同時又擔心自己會受到傷害。", "我覺得要完全信任他人是困難的。", "他人往往希望在情感上與我保持比我所感到舒適的距離更親密的關係。", "我不太確定在我需要時，是否總能依賴他人。"];
  const REVERSE = new Set([2, 7, 8, 13, 16, 17, 18]);
  const CLOSE = [1, 6, 8, 12, 13, 17];
  const DEPEND = [2, 5, 7, 14, 16, 18];
  const ANXIETY = [3, 4, 9, 10, 11, 15];

  const HIGH_CUTOFF = 3.50;
  const LOW_CUTOFF  = 2.50;

  const app = document.getElementById('app');
  const form = document.getElementById('aasForm');
  const itemsDiv = document.getElementById('items');
  const bar = document.getElementById('bar');
  const countDone = document.getElementById('countDone');
  const resultDiv = document.getElementById('result');

  function setLang(lang) {
    app.setAttribute('data-lang', lang);
    try { localStorage.setItem('aas_lang', lang); } catch (e) {}
    const btnEN = document.getElementById('btnEN');
    const btnZH = document.getElementById('btnZH');
    btnEN.classList.toggle('active', lang === 'en');
    btnZH.classList.toggle('active', lang === 'zh');
    btnEN.setAttribute('aria-selected', lang === 'en' ? 'true' : 'false');
    btnZH.setAttribute('aria-selected', lang === 'zh' ? 'true' : 'false');
  }

  function fmt(x) {
    if (x === null || Number.isNaN(x)) return '—';
    return (Math.round(x * 100) / 100).toFixed(2);
  }

  function level(mean) {
    if (mean >= HIGH_CUTOFF) return 'high';
    if (mean <= LOW_CUTOFF) return 'low';
    return 'moderate';
  }

  function dimInterpEn(text, mean) {
    if (mean >= HIGH_CUTOFF) return 'Higher score indicates greater ' + text + '.';
    if (mean <= LOW_CUTOFF) return 'Lower score suggests less ' + text + ' (relative).';
    return 'Moderate level of ' + text + '.';
  }
  function dimInterpZh(text, mean) {
    if (mean >= HIGH_CUTOFF) return '平均分較高，表示你的「' + text + '」程度較高。';
    if (mean <= LOW_CUTOFF) return '平均分較低，表示你的「' + text + '」程度相對較低。';
    return '屬中等水平的「' + text + '」。';
  }

  function classify(closeM, dependM, anxM, lang) {
    const c = level(closeM), d = level(dependM), a = level(anxM);

    if (c === 'high' && d === 'high' && a === 'low') {
      return lang === 'zh'
        ? { label: '安全型', tone: 'ok', text: '模式：親密感高＋依賴感高＋焦慮感低。對親密與依賴較自在，較少擔心被拒絕或被遺棄。' }
        : { label: 'Secure', tone: 'ok', text: 'Pattern: high Close + high Depend + low Anxiety. Comfortable with closeness and depending on others; less worry about rejection or abandonment.' };
    }
    if (a === 'high' && (c === 'moderate' || c === 'high') && (d === 'moderate' || d === 'high')) {
      return lang === 'zh'
        ? { label: '焦慮型（依戀型）', tone: 'warn', text: '模式：焦慮感高，親密感與依賴感中至高。渴望親近，但較擔心不被愛或被拒絕。' }
        : { label: 'Anxious (preoccupied)', tone: 'warn', text: 'Pattern: high Anxiety with moderate/high Close and Depend. Desire for closeness, paired with stronger worry about being rejected or unloved.' };
    }
    if (c === 'low' && d === 'low' && a === 'low') {
      return lang === 'zh'
        ? { label: '逃避型', tone: 'warn', text: '模式：親密感低＋依賴感低＋焦慮感低。較不習慣情感上的親近或依賴他人，亦較少表現出對被拒絕的擔憂。' }
        : { label: 'Avoidant', tone: 'warn', text: 'Pattern: low Close + low Depend + low Anxiety. Less comfort with emotional closeness and relying on others; generally less expressed worry about rejection.' };
    }
    return lang === 'zh'
      ? { label: '混合／不明顯', tone: 'warn', text: '你的分量表模式未能清楚符合簡單的高／中／低分類。建議以三個向度作反思，而非強行套用單一標籤。' }
      : { label: 'Mixed / Not clearly classifiable', tone: 'warn', text: 'Your pattern does not neatly match the simple high/moderate/low profiles. Discuss how each dimension might show up in relationships rather than forcing a single label.' };
  }

  function buildItems() {
    itemsDiv.innerHTML = '';
    for (let idx = 0; idx < ITEMS_EN.length; idx++) {
      const q = idx + 1;
      const isRev = REVERSE.has(q);
      const item = document.createElement('div');
      item.className = 'item';
      item.id = 'q' + q;
      item.innerHTML = `
        <div class="qhead">
          <div class="qnum">
            <span class="enOnly">Item</span><span class="zhOnly">第</span> ${q} <span class="zhOnly">題</span>
            ${isRev ? ' <span class="mono">*</span>' : ''}
          </div>
          <div class="qtext">
            <div class="enLine enOnly">${ITEMS_EN[idx]}</div>
            <div class="zhLine zhOnly">${ITEMS_ZH[idx]}</div>
            ${isRev ? `
              <div class="mutedLine enOnly">* Reverse-scored item</div>
              <div class="mutedLine zhOnly">* 反向計分題目</div>
            ` : ``}
          </div>
        </div>
        <div class="likert" role="radiogroup" aria-label="Item ${q}">
          ${[1,2,3,4,5].map(v => `
            <div class="opt">
              <input id="q${q}_${v}" name="q${q}" type="radio" value="${v}">
              <label for="q${q}_${v}">${v}</label>
            </div>
          `).join('')}
        </div>
      `;
      itemsDiv.appendChild(item);
    }
  }

  function getAnswers() {
    const ans = {};
    for (let q = 1; q <= ITEMS_EN.length; q++) {
      const el = form.querySelector('input[name="q' + q + '"]:checked');
      ans[q] = el ? Number(el.value) : null;
    }
    return ans;
  }

  function updateProgress() {
    const ans = getAnswers();
    let done = 0;
    for (let q = 1; q <= ITEMS_EN.length; q++) if (ans[q] !== null) done++;
    countDone.textContent = String(done);
    bar.style.width = (done / ITEMS_EN.length * 100).toFixed(1) + '%';
  }

  function reverseScore(q, value) {
    if (value === null) return null;
    return REVERSE.has(q) ? (6 - value) : value;
  }

  function meanOf(items, ans) {
    const vals = [];
    for (const q of items) {
      const v = reverseScore(q, ans[q]);
      if (v === null) return null;
      vals.push(v);
    }
    const sum = vals.reduce((a,b) => a + b, 0);
    return sum / vals.length;
  }

  function scrollToFirstUnanswered() {
    const ans = getAnswers();
    for (let q = 1; q <= ITEMS_EN.length; q++) {
      if (ans[q] === null) {
        const el = document.getElementById('q' + q);
        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        return;
      }
    }
    alert(app.getAttribute('data-lang') === 'zh' ? '已完成所有題目。' : 'All items are answered.');
  }

  function showResults(closeM, dependM, anxM) {
    document.getElementById('outClose').textContent = fmt(closeM);
    document.getElementById('outDepend').textContent = fmt(dependM);
    document.getElementById('outAnxiety').textContent = fmt(anxM);

    const lang = app.getAttribute('data-lang');
    if (lang === 'zh') {
      document.getElementById('txtClose').textContent = '向度：對親密與情感連結的舒適程度。 ' + dimInterpZh('親密感', closeM);
      document.getElementById('txtDepend').textContent = '向度：對依賴他人及相信他人會在需要時提供支持的程度。 ' + dimInterpZh('依賴感', dependM);
      document.getElementById('txtAnxiety').textContent = '向度：對被拒絕、不被愛或被遺棄的擔憂。 ' + dimInterpZh('焦慮感', anxM);
    } else {
      document.getElementById('txtClose').textContent = 'Dimension: comfort with closeness & intimacy. ' + dimInterpEn('comfort with closeness', closeM);
      document.getElementById('txtDepend').textContent = 'Dimension: comfort depending on others; belief others will be available. ' + dimInterpEn('comfort with depending on others', dependM);
      document.getElementById('txtAnxiety').textContent = 'Dimension: worry about being rejected or unloved. ' + dimInterpEn('worry/anxiety about rejection', anxM);
    }

    const cls = classify(closeM, dependM, anxM, lang);
    const badge = document.getElementById('styleBadge');
    badge.className = 'badge ' + cls.tone;
    badge.innerHTML = '<span>' + cls.label + '</span> <span class="mono">(' + level(closeM) + '/' + level(dependM) + '/' + level(anxM) + ')</span>';
    document.getElementById('styleText').textContent = cls.text;

    resultDiv.classList.add('show');
    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // Init
  buildItems();
  updateProgress();

  try {
    const savedLang = localStorage.getItem('aas_lang');
    if (savedLang === 'zh' || savedLang === 'en') setLang(savedLang);
  } catch (e) {}

  document.getElementById('btnEN').addEventListener('click', () => setLang('en'));
  document.getElementById('btnZH').addEventListener('click', () => setLang('zh'));

  form.addEventListener('change', updateProgress);

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const ans = getAnswers();
    const missing = [];
    for (let q = 1; q <= ITEMS_EN.length; q++) if (ans[q] === null) missing.push(q);

    if (missing.length) {
      const msg = app.getAttribute('data-lang') === 'zh'
        ? ('請先完成所有題目才可計分。未答題號：' + missing.join('、'))
        : ('Please answer all items before scoring. Missing: ' + missing.join(', '));
      alert(msg);
      scrollToFirstUnanswered();
      return;
    }

    const closeM = meanOf(CLOSE, ans);
    const dependM = meanOf(DEPEND, ans);
    const anxM = meanOf(ANXIETY, ans);
    showResults(closeM, dependM, anxM);
  });

  document.getElementById('btnUnanswered').addEventListener('click', scrollToFirstUnanswered);

  document.getElementById('btnReset').addEventListener('click', () => {
    const lang = app.getAttribute('data-lang');
    const ok = confirm(lang === 'zh' ? '確定要重設所有答案？' : 'Reset all answers?');
    if (!ok) return;
    form.reset();
    updateProgress();
    resultDiv.classList.remove('show');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  document.getElementById('btnBack').addEventListener('click', () => {
    resultDiv.classList.remove('show');
    document.getElementById('topNotice').scrollIntoView({ behavior: 'smooth', block: 'start' });
  });

  document.getElementById('btnPrint').addEventListener('click', () => window.print());
</script>
</body>
</html>
