<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NEO Big Five (60) – Bilingual</title>
<style>
:root{
  --bg:#0b1020; --muted:rgba(255,255,255,.72); --muted2:rgba(255,255,255,.55);
  --border:rgba(255,255,255,.12);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Arial, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif;
  background:
    radial-gradient(1200px 600px at 20% 0%, rgba(122,162,255,.25), transparent 55%),
    radial-gradient(900px 500px at 80% 10%, rgba(61,220,151,.18), transparent 55%),
    var(--bg);
  color:#fff;
}
.wrap{max-width:1200px;margin:0 auto;padding:26px 16px 60px}
.hero{
  border:1px solid var(--border);
  background: rgba(18,26,51,.75);
  border-radius:22px;
  padding:18px;
  backdrop-filter: blur(10px);
  box-shadow: 0 18px 50px rgba(0,0,0,.35);
}
h1{margin:0;font-size:22px}
.sub{margin-top:8px;color:var(--muted2);line-height:1.6;font-size:13px}
.pill{
  display:inline-block;margin-top:10px;margin-right:6px;font-size:12px;color:rgba(255,255,255,.82);
  border:1px solid rgba(255,255,255,.14);padding:4px 10px;border-radius:999px;background:rgba(0,0,0,.10);
}
.note{margin-top:10px;color:var(--muted);font-size:13px;line-height:1.65}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
.progress{height:10px;background:rgba(255,255,255,.10);border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,.12);margin-top:10px}
.bar{height:100%;width:0%;background:linear-gradient(90deg, rgba(122,162,255,.95), rgba(61,220,151,.85));transition:width 180ms ease}

.kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-top:12px}
@media (max-width: 980px){.kpis{grid-template-columns:1fr 1fr}}
.kpi{border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);border-radius:16px;padding:10px}
.kpi .lab{color:var(--muted);font-size:12px}
.kpi .val{font-weight:900;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size:18px;margin-top:6px}

.actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
button{
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.06);
  color:#fff;
  padding:10px 12px;
  border-radius:12px;
  cursor:pointer;
  font-weight:800;
}
button.primary{background:rgba(122,162,255,.16);border-color:rgba(122,162,255,.45)}
button.danger{background:rgba(248,113,113,.12);border-color:rgba(248,113,113,.55)}
button:hover{background:rgba(255,255,255,.09)}

.grid5{margin-top:14px;display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
@media (max-width: 980px){.grid5{grid-template-columns:1fr 1fr}}
@media (max-width: 720px){.grid5{grid-template-columns:1fr}}

.col{border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);border-radius:18px;padding:14px}
.colhead{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
.code{font-weight:900;font-size:16px}
.badge{font-size:12px;color:rgba(255,255,255,.85);border:1px solid rgba(255,255,255,.14);padding:4px 10px;border-radius:999px;background:rgba(0,0,0,.10)}

.item{border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.10);border-radius:14px;padding:10px;margin-top:10px}
.stem{display:flex;gap:10px;align-items:flex-start}
.num{
  width:26px;height:26px;border-radius:10px;background:rgba(122,162,255,.12);border:1px solid rgba(122,162,255,.35);
  display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;flex:0 0 auto;
}
.txt{line-height:1.45;color:rgba(255,255,255,.92);font-size:13px}
.choices{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px}
.opt{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.02);cursor:pointer;user-select:none}
.opt input{accent-color:rgba(122,162,255,.9)}
.score{
  font-weight:900;
  font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.12);padding:1px 7px;border-radius:999px
}

.hidden{display:none}
table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px}
th,td{border-bottom:1px solid rgba(255,255,255,.12);padding:8px;text-align:left}
th{color:rgba(255,255,255,.86)}
.langToggle{display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:10px}
.langBtn{padding:8px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); cursor:pointer; font-weight:900}
.langBtn.active{border-color: rgba(122,162,255,.55); background:rgba(122,162,255,.14)}
</style>
</head>
<body>
<div class="wrap">
  <div class="hero">
    <h1 id="title">NEO Big Five (Short Form — 60 items)</h1>
    <div class="sub" id="subtitle">Choose one option for each statement (SD → SA).</div>

    <div class="langToggle" aria-label="Language toggle">
      <span class="pill" id="langLabel">Language / 語言</span>
      <button class="langBtn" type="button" id="btnEN">English</button>
      <button class="langBtn" type="button" id="btnZH">中文</button>
    </div>

    <div class="sub" id="scaleLine">
      <span class="pill">SD</span><span class="pill">D</span><span class="pill">N</span><span class="pill">A</span><span class="pill">SA</span>
    </div>

    <nav class="shared-nav" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px;">
      <a href="index.html" style="text-decoration:none; color:#fff; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); padding:8px 10px; border-radius:999px; display:inline-flex; gap:8px; align-items:center;">
        <span style="font-weight:800;">Home</span><span style="opacity:.75;">主頁</span>
      </a>
      <a href="aas.html" style="text-decoration:none; color:#fff; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); padding:8px 10px; border-radius:999px; display:inline-flex; gap:8px; align-items:center;">
        <span style="font-weight:800;">AA Scale</span><span style="opacity:.75;">成人依附</span>
      </a>
      <a href="big5_bilingual.html" style="text-decoration:none; color:#fff; border:1px solid rgba(255,255,255,.14); background:rgba(122,162,255,.12); padding:8px 10px; border-radius:999px; display:inline-flex; gap:8px; align-items:center;">
        <span style="font-weight:800;">Big Five</span><span style="opacity:.75;">五大人格</span>
      </a>
      <a href="holland.html" style="text-decoration:none; color:#fff; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); padding:8px 10px; border-radius:999px; display:inline-flex; gap:8px; align-items:center;">
        <span style="font-weight:800;">Holland</span><span style="opacity:.75;">職業興趣</span>
      </a>
    </nav>

    <div class="note" id="scoringNote">
      <b>Scoring:</b> use the <b>numbers in the bubbles (0–4)</b> for each item, then add the 12 items in each column (same column / 直行) to get 5 totals.
    </div>

    <div class="row">
      <span class="pill" id="answeredPill">Answered: <span id="countDone">0</span>/60</span>
      <span class="pill" id="maxPill">Max per column: 12 × 4 = 48</span>
      <span class="pill" id="privacyPill">This page does not upload answers (browser-only).</span>
    </div>

    <div class="progress"><div id="bar" class="bar"></div></div>

    <div class="note" id="liveHideNote" style="margin-top:10px">
      <span class="enOnly"><b>During answering:</b> column totals are hidden. They will appear after you press <b>Score</b>.</span>
      <span class="zhOnly"><b>作答期間：</b>各欄總分會先隱藏，按下 <b>計分</b> 後才會顯示。</span>
    </div>


    <div class="kpis" aria-label="Column totals">
      <div class="kpi"><div class="lab">N</div><div class="val" id="outN">—</div></div>
      <div class="kpi"><div class="lab">E</div><div class="val" id="outE">—</div></div>
      <div class="kpi"><div class="lab">O</div><div class="val" id="outO">—</div></div>
      <div class="kpi"><div class="lab">A</div><div class="val" id="outA">—</div></div>
      <div class="kpi"><div class="lab">C</div><div class="val" id="outC">—</div></div>
    </div>

    <div class="actions">
      <button type="button" id="btnReview">Review unanswered</button>
      <button type="button" class="danger" id="btnReset">Reset</button>
      <button type="button" class="primary" id="btnScore">Score &amp; show norms</button>
    </div>

    <div id="result" class="note hidden" style="margin-top:14px; border:1px solid rgba(255,255,255,.12); background: rgba(255,255,255,.04); border-radius:18px; padding:14px;">
      <div style="font-weight:900; color: rgba(255,255,255,.9);" id="resultTitle">Results (revealed after scoring)</div>
      <div class="note" style="margin-top:6px" id="groupLine">
        Select comparison group:
        <label style="margin-left:10px"><input type="radio" name="sex" value="male" checked> Male college</label>
        <label style="margin-left:10px"><input type="radio" name="sex" value="female"> Female college</label>
      </div>
      <table>
        <thead>
          <tr>
            <th id="thDim">Dimension</th>
            <th id="thYou">Your total</th>
            <th id="thNorm">Norm mean (SD)</th>
            <th id="thZ">z</th>
            <th id="thPct">Approx. percentile</th>
          </tr>
        </thead>
        <tbody id="normRows"></tbody>
      </table>
      <div class="note" style="margin-top:10px" id="teacherNote">
        <b>Teacher note:</b> Discuss interpretation only after students finish to reduce demand characteristics.
      </div>
    </div>

    <footer id="siteFooter" class="site-footer hidden" style="margin-top:18px; padding-top:14px; border-top:1px solid rgba(255,255,255,.14); color: rgba(255,255,255,.72); font-size:12px; line-height:1.6;">
      <div style="display:flex; gap:12px; flex-wrap:wrap; justify-content:space-between; align-items:flex-start;">
        <div>
          <div style="font-weight:800; color: rgba(255,255,255,.86);">May Poon 潘美蘭</div>
          <div>Hong Kong Community College (CPCE, PolyU) 香港專上學院（理大 CPCE）</div>
          <div>Contact / 聯絡：<span style="opacity:.9;">WhatsApp only / 只限 WhatsApp：6639-5535</span></div>
        </div>
        <div style="max-width:520px;">
          <div style="font-weight:800; color: rgba(255,255,255,.86);">Use &amp; Privacy / 用途與私隱</div>
          <div id="footerPrivacy">For classroom learning and reflection. This site does not collect answers. / 僅供課堂學習與反思，本網站不會收集作答內容。</div>
        </div>
      </div>
      <div style="margin-top:10px; opacity:.8;">© 2026 May Poon. Teaching use only. / 教學用途。</div>
    </footer>
  </div>

  <div id="grid" class="grid5" aria-label="NEO items grid"></div>
</div>

<script>
const ITEMS_EN = {"1": "I am not a worrier.", "2": "I like to have a lot of people around me.", "3": "I don’t like to waste my time daydreaming.", "4": "I try to be courteous to everyone I meet.", "5": "I keep my belongings neat and clean.", "6": "I often feel inferior to others.", "7": "I laugh easily.", "8": "Once I find the right way to do something, I stick to it.", "9": "I often get into arguments with my family and co-workers.", "10": "I’m pretty good about pacing myself so as to get things done on time.", "11": "When I’m under a great deal of stress, sometimes I feel like I’m going to pieces.", "12": "I don’t consider myself especially “light-hearted.”", "13": "I am intrigued by the patterns I find in art and nature.", "14": "Some people think I’m selfish and egotistical.", "15": "I am not a very methodical person.", "16": "I rarely feel lonely or blue.", "17": "I really enjoy talking to people.", "18": "I believe letting students hear controversial speakers can only confuse and mislead them.", "19": "I would rather cooperate with others than compete with them.", "20": "I try to perform all the tasks assigned to me conscientiously.", "21": "I often feel tense and jittery.", "22": "I like to be where the action is.", "23": "Poetry has little or no effect on me.", "24": "I tend to be cynical and skeptical of others’ intentions.", "25": "I have a clear set of goals and work toward them in an orderly fashion.", "26": "Sometimes I feel completely worthless.", "27": "I usually prefer to do things alone.", "28": "I often try new and foreign foods.", "29": "I believe that most people will take advantage of you if you let them.", "30": "I waste a lot of time before settling down to work.", "31": "I rarely feel fearful or anxious.", "32": "I often feel as if I’m bursting with energy.", "33": "I seldom notice the moods or feelings that different environments produce.", "34": "Most people I know like me.", "35": "I work hard to accomplish my goals.", "36": "I often get angry at the way people treat me.", "37": "I am a cheerful, high-spirited person.", "38": "I believe we should look to our religious authorities for decisions on moral issues.", "39": "Some people think of me as cold and calculating.", "40": "When I make a commitment, I can always be counted on to follow through.", "41": "Too often, when things go wrong, I get discouraged and feel like giving up.", "42": "I am not a cheerful optimist.", "43": "Sometimes when I am reading poetry or looking at a work of art, I feel a chill or wave of excitement.", "44": "I’m hard-headed and tough-minded in my attitudes.", "45": "Sometimes I’m not as dependable or reliable as I should be.", "46": "I am seldom sad or depressed.", "47": "My life is fast-paced.", "48": "I have little interest in speculating on the nature of the universe or the human condition.", "49": "I generally try to be thoughtful and considerate.", "50": "I am a productive person who always gets the job done.", "51": "I often feel helpless and want someone else to solve my problems.", "52": "I am a very active person.", "53": "I have a lot of intellectual curiosity.", "54": "If I don’t like people, I let them know it.", "55": "I never seem to be able to get organized.", "56": "At times I have been so ashamed I just wanted to hide.", "57": "I would rather go my own way than be a leader of others.", "58": "I often enjoy playing with theories or abstract ideas.", "59": "If necessary, I am willing to manipulate people to get what I want.", "60": "I strive for excellence in everything I do."};
const ITEMS_ZH = {"1": "我不是一個充滿煩惱的人。", "2": "我喜歡很多人在我附近。", "3": "我不喜歡花時間於白日夢中。", "4": "我真的喜歡大部份我遇見的人。", "5": "我會保持我的物件整潔及整齊。", "6": "我很多時感到自己不如別人。", "7": "我很易笑。", "8": "當我找到了一幹一件事情的正確辦法後，我會堅持採用這個辦法。", "9": "我很多時與家人及同事爭論。", "10": "我頗能按照我的步伐，把事情辦妥。", "11": "當我處於極大壓力，我有時會感到好像精神崩潰似的。", "12": "我並不覺得我自己特別輕鬆、無憂無慮。", "13": "大自然和藝術的規律形態使我感到極為奧妙。", "14": "有些人覺得我自私及自我中心。", "15": "我並非一個做事有條不紊的人。", "16": "我很少感到寂寞或寂寥。", "17": "我很喜歡與別人交談。", "18": "我相信讓學生聽講者富爭論性的演講只會混淆及誤導他們的思想。", "19": "我寧願與人合作，多於與人競爭。", "20": "我會盡責地完成一切分派給我的工作。", "21": "我經常感到緊張和心神不定。", "22": "我喜歡置身於刺激的事件之中。", "23": "我對詩詞只有少許感覺甚至無動於衷。", "24": "我會懷疑及議論別人的意圖。", "25": "我有一套目標，並能有次序地朝著它而工作。", "26": "有時我感到自己完全一錢不值。", "27": "我一向喜歡單獨工作。", "28": "我很多時嘗試新的及外國的食物。", "29": "我相信如果你容許別人利用你，很多人都會這樣做。", "30": "我要花很多時間方能安頓下來工作。", "31": "我甚少感到恐懼及焦慮。", "32": "我很多時感到精力旺盛。", "33": "我甚少注意不同環境所引發的情緒或感覺。", "34": "大部份認識我的人都喜歡我。", "35": "我努力完成我的目標。", "36": "我很多時會因他人對待我的方式而感到憤怒。", "37": "我是一個快樂、富興的人。", "38": "我相信在為這德問題做決定時，我們應遵從宗教標準的判決。", "39": "有些人覺得我冷冰，有陰謀。", "40": "當我許下允諾後，別人會相信我會把事情辦妥。", "41": "很多時當事情不對勁時，我會感到挫敗及惱怒放棄。", "42": "我並不是一個快樂的樂觀者。", "43": "當我閱讀一首詩或觀看一件藝術品時，我有時會感到興奮或驚喜。", "44": "我的態度是講求實際和不感情用事。", "45": "我有時沒有我應有的可靠或可信。", "46": "我很少感到憂慮及沮喪。", "47": "我的生活步伐很快。", "48": "我沒有更惡意思索宇宙的規律及情況。", "49": "我通常會盡量體貼及顧慮周到。", "50": "我是一個多產及能把工作做好的。", "51": "我很多時感到無助，並希望有人能解決我的問題。", "52": "我是一個十分活躍的人。", "53": "我對思想性的事充滿好奇。", "54": "如果我不喜歡一個人，我會直接讓他知道。", "55": "我好像不能把事情安排得井井有條。", "56": "有時我會善忘想起來。", "57": "我寧願我行我素多於成為別人的領袖。", "58": "我喜歡思考及把玩理論及抽象的意念。", "59": "如果需要，我會願意犧牲自己而得到我所欲得的。", "60": "我凡事必須追求卓越。"};
const REVERSE = new Set([1, 3, 8, 9, 12, 14, 15, 16, 18, 23, 24, 27, 29, 30, 31, 33, 38, 39, 42, 44, 45, 46, 48, 54, 55, 57, 59]);
const NORMS = {"male": {"N": {"mean": 22.49, "sd": 7.92}, "E": {"mean": 29.22, "sd": 5.97}, "O": {"mean": 27.62, "sd": 6.08}, "A": {"mean": 28.76, "sd": 5.24}, "C": {"mean": 30.21, "sd": 7.19}}, "female": {"N": {"mean": 25.83, "sd": 7.59}, "E": {"mean": 31.27, "sd": 5.64}, "O": {"mean": 27.94, "sd": 5.72}, "A": {"mean": 31.0, "sd": 6.33}, "C": {"mean": 31.02, "sd": 6.53}}};

const TRAITS = [
  {key:'N', label:'N', items:[]},
  {key:'E', label:'E', items:[]},
  {key:'O', label:'O', items:[]},
  {key:'A', label:'A', items:[]},
  {key:'C', label:'C', items:[]}
];
for(let i=1;i<=60;i++) TRAITS[(i-1)%5].items.push(i);

const SCALE = ['SD','D','N','A','SA'];
const answers = new Map(); // item -> score 0..4

// Pedagogy: hide running totals during answering to reduce demand characteristics
let SHOW_LIVE_SCORES = false;
let LANG = localStorage.getItem('neo_lang') || 'en';

function i18n(){
  const en = LANG === 'en';
  document.getElementById('title').textContent = en ? 'NEO Big Five (Short Form — 60 items)' : 'NEO 五大人格（短版 60 題）';
  document.getElementById('subtitle').textContent = en ? 'Choose one option for each statement (SD → SA).' : '請就每句陳述選擇一個最符合的選項（SD → SA）。';

  document.getElementById('scoringNote').innerHTML = en
    ? '<b>Note:</b> Results will be revealed only after you complete all items and press <b>Score</b>.'
    : '<b>提示：</b>請先完成所有題目，按下 <b>計分</b> 後才會顯示結果。';

  document.getElementById('answeredPill').innerHTML = en ? 'Answered: <span id="countDone">0</span>/60' : '已作答：<span id="countDone">0</span>/60';
  document.getElementById('maxPill').textContent = en ? 'Max per column: 12 × 4 = 48' : '每欄最高分：12 × 4 = 48';
  document.getElementById('privacyPill').textContent = en ? 'This page does not upload answers (browser-only).' : '本頁不會上載答案（只在瀏覽器內計分）。';

  document.getElementById('btnReview').textContent = en ? 'Review unanswered' : '查看未答題目';
  document.getElementById('btnReset').textContent = en ? 'Reset' : '重設';
  document.getElementById('btnScore').textContent = en ? 'Score & show norms' : '計分並顯示常模';

  document.getElementById('resultTitle').textContent = en ? 'Results (revealed after scoring)' : '結果（按下計分後才顯示）';

  // the first text node inside groupLine is the prompt text
  const gl = document.getElementById('groupLine');
  if(gl && gl.firstChild) gl.firstChild.nodeValue = en ? 'Select comparison group: ' : '選擇比較組別：';

  document.getElementById('thDim').textContent = en ? 'Dimension' : '向度';
  document.getElementById('thYou').textContent = en ? 'Your total' : '你的總分';
  document.getElementById('thNorm').textContent = en ? 'Norm mean (SD)' : '常模平均（SD）';
  document.getElementById('thPct').textContent = en ? 'Approx. percentile' : '約百分位';

  document.getElementById('teacherNote').innerHTML = en
    ? '<b>Teacher note:</b> Discuss interpretation only after students finish to reduce demand characteristics.'
    : '<b>教師提示：</b>建議學生完成後才討論分數意義，以減少需求特徵。';

  document.getElementById('btnEN').classList.toggle('active', en);
  document.getElementById('btnZH').classList.toggle('active', !en);
}

function getItems(){ return LANG === 'en' ? ITEMS_EN : ITEMS_ZH; }

function scoreOptionsForItem(itemNo){
  const forward=[0,1,2,3,4];
  const reverse=[4,3,2,1,0];
  return REVERSE.has(itemNo) ? reverse : forward;
}

function updateTop(){
  let done=0;
  for(let i=1;i<=60;i++) if(answers.has(i)) done++;
  const countEl = document.getElementById('countDone');
  if(countEl) countEl.textContent = String(done);
  document.getElementById('bar').style.width=(done/60*100).toFixed(1)+'%';

  // Hide running totals during answering (to reduce demand characteristics).
  // Show totals only after scoring.
  if(!SHOW_LIVE_SCORES){
    document.getElementById('outN').textContent = '—';
    document.getElementById('outE').textContent = '—';
    document.getElementById('outO').textContent = '—';
    document.getElementById('outA').textContent = '—';
    document.getElementById('outC').textContent = '—';
    return;
  }

  const totals={N:0,E:0,O:0,A:0,C:0};
  for(const t of TRAITS){
    let sum=0;
    for(const i of t.items) if(answers.has(i)) sum+=answers.get(i);
    totals[t.key]=sum;
  }
  document.getElementById('outN').textContent=String(totals.N);
  document.getElementById('outE').textContent=String(totals.E);
  document.getElementById('outO').textContent=String(totals.O);
  document.getElementById('outA').textContent=String(totals.A);
  document.getElementById('outC').textContent=String(totals.C);
}

function setAnswer(itemNo, score){ answers.set(itemNo, score); updateTop(); }

function scrollToFirstUnanswered(){
  for(let i=1;i<=60;i++){
    if(!answers.has(i)){
      const el=document.getElementById('item-'+i);
      if(el) el.scrollIntoView({behavior:'smooth', block:'center'});
      return;
    }
  }
  alert(LANG==='en' ? 'All answered ✅' : '已全部作答 ✅');
}

function resetAll(){
  if(!confirm(LANG==='en' ? 'Reset and clear all answers?' : '確定要重設所有作答嗎？')) return;
  answers.clear();
  document.querySelectorAll('input[type="radio"]').forEach(r=>r.checked=false);
  document.getElementById('result').classList.add('hidden');
  SHOW_LIVE_SCORES = false;
  const ft = document.getElementById('siteFooter');
  if(ft) ft.classList.add('hidden');
  updateTop();
  window.scrollTo({top:0, behavior:'smooth'});
}

function normCdf(z){
  const t = 1/(1+0.2316419*Math.abs(z));
  const d = 0.3989423*Math.exp(-z*z/2);
  let p = d*t*(0.3193815 + t*(-0.3565638 + t*(1.781478 + t*(-1.821256 + t*1.330274))));
  p = 1-p;
  return z<0 ? 1-p : p;
}

function computeTotals(){
  const totals={N:0,E:0,O:0,A:0,C:0};
  for(const t of TRAITS){
    let sum=0;
    for(const i of t.items){
      if(!answers.has(i)) return null;
      sum+=answers.get(i);
    }
    totals[t.key]=sum;
  }
  return totals;
}

function renderNorms(){
  const totals=computeTotals();
  if(!totals){
    alert(LANG==='en' ? 'Please answer all items before scoring.' : '請先完成所有題目才可計分。');
    scrollToFirstUnanswered();
    return;
  }
  const sex=document.querySelector('input[name="sex"]:checked').value;
  const norm=NORMS[sex];
  const traitNames={N:'Neuroticism',E:'Extraversion',O:'Openness',A:'Agreeableness',C:'Conscientiousness'};

  const tbody=document.getElementById('normRows');
  tbody.innerHTML='';
  for(const k of ['N','E','O','A','C']){
    const mean=norm[k].mean, sd=norm[k].sd;
    const score=totals[k];
    const z=(score-mean)/sd;
    const pct=Math.round(normCdf(z)*100);

    const tr=document.createElement('tr');
    tr.innerHTML = (LANG==='en')
      ? `<td><b>${k}</b> – ${traitNames[k]}</td><td>${score}</td><td>${mean.toFixed(2)} (${sd.toFixed(2)})</td><td>${z.toFixed(2)}</td><td>${pct}th</td>`
      : `<td><b>${k}</b> – ${traitNames[k]}</td><td>${score}</td><td>${mean.toFixed(2)} (${sd.toFixed(2)})</td><td>${z.toFixed(2)}</td><td>${pct} 百分位</td>`;
    tbody.appendChild(tr);
  }

  SHOW_LIVE_SCORES = true;
  updateTop();
  document.getElementById('result').classList.remove('hidden');
  const ft = document.getElementById('siteFooter');
  if(ft) ft.classList.remove('hidden');
  document.getElementById('result').scrollIntoView({behavior:'smooth', block:'start'});
}

function buildGrid(){
  const grid=document.getElementById('grid');
  grid.innerHTML='';
  const ITEMS = getItems();

  for(const t of TRAITS){
    const col=document.createElement('section');
    col.className='col';

    const head=document.createElement('div');
    head.className='colhead';
    head.innerHTML=`<div class="code">${t.label}</div><div class="badge">12 items</div>`;
    col.appendChild(head);

    for(const itemNo of t.items){
      const item=document.createElement('div');
      item.className='item';
      item.id='item-'+itemNo;

      const stem=document.createElement('div');
      stem.className='stem';
      stem.innerHTML=`<div class="num">${itemNo}</div><div class="txt">${ITEMS[itemNo] || ''}</div>`;
      item.appendChild(stem);

      const choices=document.createElement('div');
      choices.className='choices';

      const scores=scoreOptionsForItem(itemNo);
      scores.forEach((sc, idx)=>{
        const name='q'+itemNo;
        const label=document.createElement('label');
        label.className='opt';
        label.innerHTML=`<input type="radio" name="${name}" value="${sc}"><span>${SCALE[idx]}</span>`;
        const input = label.querySelector('input');
        input.addEventListener('change', (e)=>setAnswer(itemNo, Number(e.target.value)));

        if(answers.has(itemNo) && answers.get(itemNo)===sc) input.checked=true;
        choices.appendChild(label);
      });

      item.appendChild(choices);
      col.appendChild(item);
    }
    grid.appendChild(col);
  }
  updateTop();
}

function setLang(newLang){
  LANG = newLang;
  localStorage.setItem('neo_lang', LANG);
  i18n();
  buildGrid();
}

document.getElementById('btnEN').addEventListener('click', ()=>setLang('en'));
document.getElementById('btnZH').addEventListener('click', ()=>setLang('zh'));
document.getElementById('btnReview').addEventListener('click', scrollToFirstUnanswered);
document.getElementById('btnReset').addEventListener('click', resetAll);
document.getElementById('btnScore').addEventListener('click', renderNorms);
document.querySelectorAll('input[name="sex"]').forEach(el => el.addEventListener('change', ()=>{
  if(!document.getElementById('result').classList.contains('hidden')) renderNorms();
}));

// init
i18n();
buildGrid();
</script>
</body>
</html>
